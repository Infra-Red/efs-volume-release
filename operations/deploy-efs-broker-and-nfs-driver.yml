### NOTE: this ops file depends on cf-deployment/operations/enable-nfs-volume-service.yml as we no longer deploy a
### separate volume driver for efs.

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/cc/volume_services_enabled?
  value: true
- type: replace
  path: /instance_groups/name=cc-worker/jobs/name=cloud_controller_worker/properties/cc/volume_services_enabled?
  value: true
- type: replace
  path: /instance_groups/name=scheduler/jobs/name=cloud_controller_clock/properties/cc/volume_services_enabled?
  value: true

- type: replace
  path: /releases/-
  value:
    name: efs-volume
    version: latest
- type: replace
  path: /releases/name=nfs-volume?
  value:
    name: nfs-volume
    sha1: 84c39ded90aed61d38dc52d10b2ff59d3248f621
    url: https://bosh.io/d/github.com/cloudfoundry/nfs-volume-release?v=1.4.0
    version: 1.4.0
- type: replace
  path: /releases/name=mapfs?
  value:
    name: mapfs
    sha1: 9dcea268d327caff76690229ac09f57a0c83cf65
    url: https://bosh.io/d/github.com/cloudfoundry/mapfs-release?v=1.0.1
    version: 1.0.1

- type: replace
  path: /variables/-
  value:
    name: efs-broker-password
    type: password

- type: replace
  path: /instance_groups/-
  value:
    name: efsbroker
    azs:
    - z1
    instances: 1
    vm_type: minimal
    stemcell: default
    networks:
      - name: default
    jobs:
    - name: efsbroker
      release: efs-volume
      properties:
        efsbroker:
          listen-addr: 0.0.0.0:8999
          service-name: efs
          service-id: d0406c23-c33f-4f10-804b-9083a486d857
          data-dir: /var/vcap/store/efsbroker
          username: admin
          password: ((efs-broker-password))
          aws-region: us-west-2
          aws-access-key-id: ((aws-access-key-id))
          aws-secret-access-key: ((aws-secret-access-key))
          aws-subnet-ids: ((aws-subnet-ids))
          aws-security-groups: ((aws-security-groups))
          aws-azs: ((aws-azs))
    - name: efsdriver
      release: efs-volume
      properties:
        efsdriver:
          listen_addr: 127.0.0.1:7089
          efs_vol_tools_addr: 127.0.0.1:7090
          debug_addr: 127.0.0.1:7189
          driver_path: /var/vcap/data/voldrivers
          cell_mount_path: /var/vcap/data/volumes/efs
          log_level: info
    - name: route_registrar
      release: routing
      properties:
        route_registrar:
          routes:
          - name: efs-broker
            port: 8999
            registration_interval: 20s
            tags:
              component: efs-broker
            uris:
            - efs-broker.((system_domain))
- type: replace
  path: /instance_groups/name=diego-cell/jobs/name=nfsv3driver?
  value:
    name: nfsv3driver
    properties: {}
    release: nfs-volume
- type: replace
  path: /instance_groups/name=diego-cell/jobs/name=mapfs?
  value:
    name: mapfs
    release: mapfs
